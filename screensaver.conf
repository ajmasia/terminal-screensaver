#!/bin/bash
# Screensaver configuration loader
# Sources user config and provides defaults

CONFIG_FILE="$HOME/.config/slimbook-screensaver/screensaver.conf"
SCREENSAVER_DIR="$HOME/.local/share/slimbook-screensaver"

# Default values
SLIMBOOK_SCREENSAVER_TERMINAL="${SLIMBOOK_SCREENSAVER_TERMINAL:-alacritty}"
SLIMBOOK_SCREENSAVER_ASCII_FILE="${SLIMBOOK_SCREENSAVER_ASCII_FILE:-$SCREENSAVER_DIR/screensaver.txt}"
SLIMBOOK_SCREENSAVER_IDLE_TIMEOUT="${SLIMBOOK_SCREENSAVER_IDLE_TIMEOUT:-120}"
SLIMBOOK_SCREENSAVER_FRAME_RATE="${SLIMBOOK_SCREENSAVER_FRAME_RATE:-60}"
SLIMBOOK_SCREENSAVER_EXCLUDE_EFFECTS="${SLIMBOOK_SCREENSAVER_EXCLUDE_EFFECTS:-dev_worm}"
SLIMBOOK_SCREENSAVER_FONT_SIZE="${SLIMBOOK_SCREENSAVER_FONT_SIZE:-16}"

# Load user config if exists
if [[ -f "$CONFIG_FILE" ]]; then
    # shellcheck source=/dev/null
    source "$CONFIG_FILE"
fi

# Validate terminal choice and check availability
case "$SLIMBOOK_SCREENSAVER_TERMINAL" in
    alacritty|gnome-terminal|ptyxis)
        if ! command -v "$SLIMBOOK_SCREENSAVER_TERMINAL" &>/dev/null; then
            echo "Warning: Terminal '$SLIMBOOK_SCREENSAVER_TERMINAL' not found. Using gnome-terminal." >&2
            SLIMBOOK_SCREENSAVER_TERMINAL="gnome-terminal"
        fi
        ;;
    *)
        echo "Warning: Invalid terminal '$SLIMBOOK_SCREENSAVER_TERMINAL'. Using gnome-terminal." >&2
        SLIMBOOK_SCREENSAVER_TERMINAL="gnome-terminal"
        ;;
esac

# Export all config variables
export SLIMBOOK_SCREENSAVER_TERMINAL
export SLIMBOOK_SCREENSAVER_ASCII_FILE
export SLIMBOOK_SCREENSAVER_IDLE_TIMEOUT
export SLIMBOOK_SCREENSAVER_FRAME_RATE
export SLIMBOOK_SCREENSAVER_EXCLUDE_EFFECTS
export SLIMBOOK_SCREENSAVER_FONT_SIZE
